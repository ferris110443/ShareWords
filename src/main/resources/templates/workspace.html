<!doctype html>
<html>
<head>
    <title>Workspace</title>
    <style>

    </style>
    <link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" rel="stylesheet">
    <link href="/src/pages/common.css" rel="stylesheet">
    <link href="/src/components/asideWorkspace.css" rel="stylesheet">
    <link href="/src/pages/workspace.css" rel="stylesheet">
</head>
<body class="hidden">

<div class="container">
    <div id="sidebar-placeholder"></div>
    <div style="background-color: rgba(225, 225, 255, 0.7); width: 5px; display: block;"></div>
    <div class="mid-workspace ">
        <div class="content-section" id="room-zone">
            <h2>Workspace members</h2>
            <div id="userList">
                <div> Alice</div>
                <div> Bob</div>
                <div> Tony</div>
            </div>
            <h2> Add members</h2>
            <div id="add-friend-member">

            </div>
        </div>

        <div class="content-section" id="file-zone" style="display: none;">
            <h2>Existed Files</h2>
            <div id="fileList">
            </div>
        </div>
    </div>
    <div style="background-color: rgba(225, 225, 255, 0.7); width: 5px; display: block;"></div>
    <div class="right-workspace">
        <div id="workspace-information-container">
            <div id="workspace-information-head">
                <h2>Workspace Information</h2>
            </div>

            <div id="workspace-information">
                <p><strong>Name:</strong> <span id="workspace-name"></span></p>
                <p><strong>Description:</strong><span id="workspace-description"></span></p>
                <p><strong>Owner:</strong> <span id="workspace-owner"></span></p>
                <p><strong>Creation Date:</strong> <span id="workspace-creation-date"></span></p>
                <button class="edit-workspace-btn btn btn-primary" onclick="toggleEdit()" type="button">Edit Workspace
                </button>
                <button class="delete-workspace-btn btn btn-danger" id="delete-workspace-btn" type="button">Delete
                    Workspace
                </button>
            </div>
            <div id="edit-workspace-form" style="display:none;">
                <p><strong>Name:</strong>
                    <span id="workspace-name-edit">
                        <input id="edit-name" placeholder="Enter new name" type="text">
                    </span>
                </p>
                <p><strong>Description:</strong>
                    <span id="workspace-description-edit">
                        <input id="edit-description" placeholder="Enter new description" type="text">
                    </span>
                </p>
                <!--                <p><strong>Owner:</strong>-->
                <!--                    <span id="workspace-owner-edit">-->
                <!--                        <input id="edit-owner" placeholder="Enter new owner" type="text">-->
                <!--                    </span>-->
                <!--                </p>-->

                <button class="save-btn btn btn-success" id="edit-workspace-save-btn" type="button">Save Changes
                </button>
            </div>

        </div>
        <div id="create-new-file-container">
            <div id="create-new-file-container-head">
                <h2>Creat New File</h2>
            </div>
            <div id="create-new-file">
                <form id="file-creation-form">
                    <div>
                        <label for="file-name-input">File Name</label>
                        <input aria-label="file-name-input" id="file-name-input" maxlength="128"
                               name="file" placeholder="Enter file name (maximum 128 characters)" required
                               type="text">
                    </div>
                    <div>
                        <label for="file-description">File description</label>
                        <textarea aria-label="file-description" id="file-description" maxlength="255"
                                  name="file-description" placeholder="Enter file name (maximum 255 characters)"
                                  required></textarea>
                    </div>
                    <button class="create-btn btn btn-success" type="submit">Create File</button>
                </form>
            </div>

        </div>

        <div id="groupChat-container">
            <div id="groupChat-container-head">
                <h2>Group Chat</h2>
            </div>
            <div id="groupChat">
                <div id="chat-box">
                    <div id="chat-messages">
                    </div>
                </div>
                <div id="chat-input">
                    <input id="chat-input-box" placeholder="Enter your message" type="text">
                    <button class="btn btn-primary" id="chat-send-btn">Send</button>
                </div>
            </div>

        </div>
    </div>
</div>
<div class="modal" id="friendRequestModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">New Friend Request</h5>
                <button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button>
            </div>
            <div class="modal-body">
                <p id="friendRequestMessage"></p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-bs-dismiss="modal" type="button">Close</button>
            </div>
        </div>
    </div>
</div>


<script crossorigin="anonymous"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.9/ace.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

<script crossorigin="anonymous"
        integrity="sha384-2huaZvOR9iDzHqslqwpR87isEmrfxqyWOF7hr7BY6KG0+hVKLoEXMPUJw3ynWuhO"
        src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="/src/components/asideWorkspace.js"></script>
<script src="/src/pages/workspace.js"></script>
<script src="/src/pages/socketIO.js"></script>
<script>
    const now = new Date();
    const messagesContainer = document.getElementById('chat-messages');
    const inputBox = document.getElementById('chat-input-box');
    const sendButton = document.getElementById('chat-send-btn');
    const formattedDateTime = now.toLocaleString('en-CN').replace(',', '');

    socket.on('connect', () => {
        socket.emit('joinRoom', roomId);
    });


    sendButton.addEventListener('click', function () {
        const messageText = inputBox.value.trim();
        if (messageText) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message');
            messageDiv.textContent = messageText;
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            inputBox.value = '';
        }
        socket.emit('chatMessage', {message: messageText, accessToken: accessToken, roomId: roomId}); // Send message to server

    });

    inputBox.addEventListener('keyup', function (event) {
        if (event.key === 'Enter') {
            event.preventDefault();
            sendButton.click();
        }
    });

    socket.on("chatMessage", function (chatMessageDto) {
        console.log('Received chat message:', chatMessageDto);
        const chatMessages = document.getElementById('chat-messages');
        const messageElement = document.createElement('div');
        if (chatMessageDto.accessToken === accessToken) {
            messageElement.className = 'self-message';
            messageElement.innerHTML = `
                <div class="chat-message-text"> ${chatMessageDto.message}</div>
                <div class="chat-message-time">${formattedDateTime}</div>
            `;

        } else {
            messageElement.innerHTML = `
                <div class="chat-message-friends"><strong>${chatMessageDto.userEmail} : </strong></div>
                <div class="message">
                    <div class="chat-message-text-friends">${chatMessageDto.message}</div>
                    <div class="chat-message-time">${formattedDateTime}</div>
                </div>
            `;
        }

        chatMessages.appendChild(messageElement);
    });


</script>

</body>
</html>
