<!doctype html>
<html>
  <head>
    <title>Ace CRDT</title>
    <style>
      html, body {
        height: 100%;
      }

      h1 {
        font-size: 1.5rem;
        margin: 0;
      }

      body {
        display: flex;
        flex-direction: column;
      }

      #editor {
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        font-family: monospace;
        font-size: 1.5rem;
      }

      #editor-container {
        position: relative;
        width: 100%;
        flex: 1 1;
      }
    </style>
  </head>
  <body>
    <div>
      <h1>Collaborative text editing using CRDT</h1>
      <p>
        This demo makes sense when more than one person connects and
        writes at the same time, some quirks are to be expected, but the
        text should remain the same across clients. The contents are
        cleared at least once per day.
        <strong>Please be kind to each other.</strong>
        <br>
        Source and details:
      </p>
    </div>

    <div id="editor-container">
      <div id="editor"></div>
    </div>
    <br>
    <div id="preview" style="border: 1px solid #ccc; margin-top: 20px; padding: 10px;">
      Preview will appear here...
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.9/ace.min.js"></script>
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js" integrity="sha384-2huaZvOR9iDzHqslqwpR87isEmrfxqyWOF7hr7BY6KG0+hVKLoEXMPUJw3ynWuhO" crossorigin="anonymous"></script>
    <script src="/rga.js"></script>
    <script type="module" src="editor.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
      // Initialize Ace Editor => interact with api need to work with its api
      var editor = ace.edit("editor");

      // Add change event listener
      editor.getSession().on('change', function() {
        updatePreview();
      });

      function updatePreview() {
        var markdownText = editor.getValue(); // Get the text from Ace Editor
        var htmlContent = marked.parse(markdownText); // Parse markdown to HTML
        console.log(markdownText);
        console.log(htmlContent);
        document.getElementById("preview").innerHTML = htmlContent; // Display the HTML in the preview div
      }

      // Initial call to display default content
      updatePreview();
    </script>
  </body>
</html>
